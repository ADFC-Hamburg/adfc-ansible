- name: Setup Hetzner Server
  hosts: jitsi_vbs
  gather_facts: no
  roles:
    - hcloud-server
  vars:
    hcloud_test: false

- name: Setup Videobridge
  hosts: jitsi_vbs
  gather_facts: yes
  roles:
    - ssh-keys
    - update-os
    - restore-hcloud-letsenrypt
    - geerlingguy.certbot
    - jitsi-videobridge
    - telegraf
  tasks:
    - name: Alles neu starten etc
      meta: flush_handlers

    - name: Wait 20 seconds
      pause:
        seconds: 20
      when: hostvars[jitsi_meet_server_name].stop_jitsi_vb_on_main | dafault('false')

    - name: Stop Jitsi-Meet vb
      systemd:
        name: jitsi-videobridge2
        state: stopped
      delegate_to: "{{ jitsi_meet_server_name }}"
      when: hostvars[jitsi_meet_server_name].stop_jitsi_vb_on_main | dafault('false')