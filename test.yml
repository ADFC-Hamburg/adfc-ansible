---
- name: Test Playbook
  hosts: ucs-master.gst.hamburg.adfc.de

  tasks:
  - name: Create guacamole config for the client
    command:
      argv:
        - /usr/sbin/udm guacamole/config create
        - --position cn=guacamole,dc=hamburg,dc=adfc,dc=de
        - --set name={{ inventory_hostname_short }}
        - '--set description="Verbindung zum Rechner: {{ inventory_hostname_short }}"'
        - --set guacConfigProtocol=rdp
        - --set guacConfigParameter=enable-sftp=true
        - --set guacConfigParameter=sftp-username=${GUAC_USERNAME}
        - --set guacConfigParameter=sftp-password=${GUAC_PASSWORD}
        - --set guacConfigParameter=enable-drive=true
        - --set guacConfigParameter=username=${GUAC_USERNAME}
        - --set guacConfigParameter=password=${GUAC_PASSWORD}
        - --set guacConfigParameter=hostname={{ inventory_hostname }}
        - --set guacConfigParameter=enable-font-smoothing=true
        - --set guacConfigParameter=server-layout=de-de-qwertz
        - --set guacConfigParameter=enable-printing=true
        - --set nestedGroup=cn="Domain Admins",cn=groups,dc=hamburg,dc=adfc,dc=de
        - --set nestedGroup=cn="Domain Users",cn=groups,dc=hamburg,dc=adfc,dc=de
        - --ignore_exists
