# GitHub Actions docs
# https://help.github.com/en/articles/about-github-actions
# https://help.github.com/en/articles/workflow-syntax-for-github-actions
# see also: https://github.com/filipesilva/ng-github-actions/blob/master/.github/workflows/main.yml
name: CI

on: [push]

jobs:
  build:

    # Machine environment:
    runs-on: ubuntu-20.04

    steps:
    - name: install ansible-lint
      run: |
       pip3 install ansible-lint==5.0.7 ansible==2.10.7
    - name: Checkout
      uses: actions/checkout@v2
    - name: Fetch Roles Ansible-Galaxy
      run: ~/.local/bin/ansible-galaxy install -r requirements.yml
    - name: lint files
      run: ~/.local/bin/ansible-lint -vvvv --exclude=/home/runner/.ansible/roles/jnv.unattended-upgrades/  $(find *.yml \! -name inventory.yml -a \! -name requirements.yml )
    - name: Syntax check
      run: ~/.local/bin/ansible-playbook --syntax-check $(find *.yml \! -name inventory.yml -a \! -name requirements.yml )
