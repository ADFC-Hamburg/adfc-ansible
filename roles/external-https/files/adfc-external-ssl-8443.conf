
<IfModule mod_ssl.c>

Listen 8443
<VirtualHost *:8443>


	SSLEngine on
	SSLProxyEngine on
	SSLProxyCheckPeerCN off
	SSLProxyCheckPeerName off
	SSLProxyCheckPeerExpire off
	SSLCertificateFile /etc/univention/letsencrypt/signed_chain.crt
	SSLCertificateKeyFile /etc/univention/letsencrypt/domain.key
	SSLCACertificateFile /etc/univention/ssl/ucsCA/CAcert.pem

	Header always set Strict-Transport-Security "max-age=63072000;"
	#SetEnvIf User-Agent ".*MSIE.*" nokeepalive ssl-unclean-shutdown

	### To enable special log format for HTTPS-access
	# LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-agent}i\" %p" combinedssl
	# CustomLog /var/log/apache2/access.log combinedssl	## with port number
        SSLCACertificatePath /etc/univention/ssl/ucsCA/

        # Revocation list
        SSLCARevocationFile  /etc/univention/ssl/ucsCA/crl/crl.pem

        SSLVerifyClient require
        SSLVerifyDepth       5

	RewriteEngine on
	RewriteOptions Inherit
	ProxyPreserveHost on
	ProxyTimeout 600
	
	RequestHeader set "X-Forwarded-Proto" expr=%{REQUEST_SCHEME}
	RequestHeader set "X-Forwarded-SSL" expr=%{HTTPS}

	DocumentRoot /var/www/
	CustomLog /var/log/apache2/access.log combined
	RedirectMatch ^/$ https://ucs-master.gst.hamburg.adfc.de/univention/portal/ 


	ProxyPass /univention/portal/portal.json http://127.0.0.1:8095/ retry=0
	ProxyPassReverse /univention/portal/portal.json http://127.0.0.1:8095/

	<Directory /var/www/univention/portal/>
        	   <FilesMatch "(portal|apps)\.json|portal\.css">
		          Header set Cache-Control "max-age=0, must-revalidate"
		   </FilesMatch>
	</Directory>
	<Directory /var/www/univention/portal/icons>
	       Header set Cache-Control "max-age=0, must-revalidate"
	</Directory>

	ProxyPass /guacamole/ http://127.0.0.1:40001/guacamole/ retry=0
	ProxyPassReverse /guacamole/ http://127.0.0.1:40001/guacamole/

SSLProtocol             all -SSLv3 -TLSv1 -TLSv1.1
SSLCipherSuite          ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384
SSLHonorCipherOrder     off
#SSLSessionTickets       off#

#SSLUseStapling On
#SSLStaplingCache "shmcb:logs/ssl_stapling(32768)"

#	<Location /proxmox01>
#	    ProxyPass  https://192.168.123.3:8006
#            ProxyPassReverse https://192.168.123.3:8006
#	</Location>
</VirtualHost>
</IfModule>
