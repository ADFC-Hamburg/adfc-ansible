- name: "dynamic-jitsi-sclaer |  test {{ testcase.name }} | set meet participants"
  copy:
    dest: /tmp/dyn_jitsi_query_participants-meet.txt
    content: "{{ testcase.participants.meet }}"

- name: "dynamic-jitsi-sclaer |  test {{ testcase.name }} | set vbh participants"
  copy:
    dest: /tmp/dyn_jitsi_query_participants-vbh01.txt
    content: "{{ testcase.participants.vbh01 }}"

- name: "dynamic-jitsi-sclaer |  test {{ testcase.name }} | set vbh participants"
  copy:
    dest: /tmp/dyn_jitsi_query_participants-vbh02.txt
    content: "{{ testcase.participants.vbh02 }}"

- name: "dynamic-jitsi-sclaer |  test {{ testcase.name }} | set meet conferences"
  copy:
    dest: /tmp/dyn_jitsi_query_conferences-meet.txt
    content: "{{ testcase.conferences.meet }}"

- name: "dynamic-jitsi-sclaer |  test {{ testcase.name }} | set vbh participants"
  copy:
    dest: /tmp/dyn_jitsi_query_conferences-vbh01.txt
    content: "{{ testcase.conferences.vbh01 }}"

- name: "dynamic-jitsi-sclaer |  test {{ testcase.name }} | set vbh participants"
  copy:
    dest: /tmp/dyn_jitsi_query_conferences-vbh02.txt
    content: "{{ testcase.conferences.vbh02 }}"

- name: "dynamic-jitsi-sclaer |  test {{ testcase.name }} | set hetzner result"
  copy:
    dest: /tmp/dyn_jitsi_query_hetzner_server.txt
    content: "{{ testcase.hcloud_api }}"

- name: "dynamic-jitsi-sclaer |  test {{ testcase.name }} | run"
  command: /usr/local/bin/dynamic-jitsi-scaler-test
  register: djs_testcase
  failed_when: (djs_testcase.rc != 0)  or (djs_testcase.stderr |length >0)

- name: "dynamic-jitsi-sclaer |  test {{ testcase.name }} | check vbh01 setup playbook is {{ testcase.result.playbook_setup_vbh01 }}"
  stat:
    path: /tmp/dyn_jitsi_playbook-vbh01.meet.adfc-intern.de-setup-meet-vb.yml
  register: mystat
  failed_when: mystat.stat.exists != testcase.result.playbook_setup_vbh01

- name: "dynamic-jitsi-sclaer |  test {{ testcase.name }} | check vbh01 delete playbook is {{ testcase.result.playbook_delete_vbh01 }}"
  stat:
    path: /tmp/dyn_jitsi_playbook-vbh01.meet.adfc-intern.de-delete-meet-vb.yml
  register: mystat
  failed_when: mystat.stat.exists != testcase.result.playbook_delete_vbh01

- name: "dynamic-jitsi-sclaer |  test {{ testcase.name }} | check vbh02 setup playbook is {{ testcase.result.playbook_setup_vbh02 }}"
  stat:
    path: /tmp/dyn_jitsi_playbook-vbh02.meet.adfc-intern.de-setup-meet-vb.yml
  register: mystat
  failed_when: mystat.stat.exists != testcase.result.playbook_setup_vbh02

- name: "dynamic-jitsi-sclaer |  test {{ testcase.name }} | check vbh02 delete playbook is {{ testcase.result.playbook_delete_vbh02 }}"
  stat:
    path: /tmp/dyn_jitsi_playbook-vbh02.meet.adfc-intern.de-delete-meet-vb.yml
  register: mystat
  failed_when: mystat.stat.exists != testcase.result.playbook_delete_vbh02


- name: "dynamic-jitsi-sclaer |  test {{ testcase.name }} | clean"
  include_tasks: "clean_test.yml"