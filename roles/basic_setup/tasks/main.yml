---
- name: Install base packages
  ansible.builtin.apt:
    name: "{{ basic_setup_base_packages }}"

- name: Check if custom sources.list template exists for this distribution
  ansible.builtin.stat:
    path: "{{ role_path }}/templates/{{ ansible_distribution | lower }}-{{ ansible_distribution_major_version }}-sources.list.j2"
  register: custom_sources_template
  delegate_to: localhost
  become: no

# this must be done after base packages are installed, cause of apt-transport-https
- name: Configure distribution-specific sources.list
  ansible.builtin.template:
    src: "{{ ansible_distribution | lower }}-{{ ansible_distribution_major_version }}-sources.list.j2"
    dest: /etc/apt/sources.list
    owner: root
    group: root
    mode: "0644"
    backup: yes
  when: custom_sources_template.stat.exists
  notify: Update apt cache

- name: Setup Journald Settings
  ansible.builtin.template:
    src: base-journald.conf
    dest: /etc/systemd/journald.conf
    mode: "0644"
  notify:
    - Restart journald

- name: Downloadverzeichnis f√ºr deb-Pakete erstellen
  ansible.builtin.file:
    path: /usr/local/share/ansible_downloads/
    state: directory
    mode: 0755

- name: Prevent sleep
  ansible.builtin.systemd:
    name: sleep.target
    masked: true

- name: Prevent suspend
  ansible.builtin.systemd:
    name: suspend.target
    masked: true

- name: Prevent hibernate
  ansible.builtin.systemd:
    name: hibernate.target
    masked: true

- name: Prevent hybrid-sleep
  ansible.builtin.systemd:
    name: hybrid-sleep.target
    masked: true

- name: Setze die Umask auf 0007
  ansible.builtin.copy:
    content: umask 0007
    dest: /etc/profile.d/ansibe_adfc.sh
    owner: root
    group: root
    mode: "0755"
  tags: umask
