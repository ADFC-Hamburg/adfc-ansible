---
- name: Installiere gdm3
  ansible.builtin.apt:
    name:
      - gdm3

- name: Create directories
  ansible.builtin.file:
    path: "{{ item }}"
    state: directory
    mode: 0755
    owner: root
    group: root
  tags: gdm
  loop:
    - "/usr/share/plasma/desktoptheme/ADFC"
    - "/usr/share/plasma/desktoptheme/ADFC/icons"
    - "/usr/share/wallpapers/ADFC"
    - "/usr/share/wallpapers/ADFC/contents"
    - "/usr/share/wallpapers/ADFC/contents/images"
    - "/usr/share/kubuntu-default-settings/kf5-settings"
    - "/usr/share/gnome-shell/theme"
- name: Sync Theme folder
  ansible.builtin.copy:
    src: "desktopthemes/ADFC/{{ item}}"
    dest: "/usr/share/plasma/desktoptheme/ADFC/{{ item }}"
    mode: "0644"
    owner: root
    group: root
  tags: gdm
  loop:
    - "icons/start.svgz"
    - "metadata.desktop"

- name: Copy config for default desktoptheme
  ansible.builtin.copy:
    src: desktopthemes/kubuntu-default-plasmarc
    dest: /usr/share/kubuntu-default-settings/kf5-settings/plasmarc
    mode: 0644
  tags: gdm

- name: Sync wallpaper directory
  ansible.builtin.copy:
    src: "wallpapers/ADFC/{{ item }}"
    dest: "/usr/share/wallpapers/ADFC/{{ item }}"
    mode: "0644"
    owner: root
    group: root
  tags: gdm
  loop:
    - "contents/images/1920x1200.png"
    - "contents/screenshot.png"
    - "metadata.desktop"

- name: Create Themes Directory
  ansible.builtin.file:
    path: /usr/local/share/themes/adfc/
    state: directory
    mode: 0755
  tags: gdm

- name: Copy ADFC Logo
  ansible.builtin.copy:
    src: ADFC-HH-rgb.jpg
    dest: /usr/local/share/themes/adfc/ADFC-HH-rgb.jpg
    mode: 0644
  tags: gdm

- name: Remove Gnome Desktop file ubuntu.desktop
  ansible.builtin.command:
    argv:
      - /bin/mv
      - /usr/share/xsessions/ubuntu.desktop
      - /usr/share/xsessions/ubuntu.desktop.dontuse
    creates: /usr/share/xsessions/ubuntu.desktop.dontuse
    removes: /usr/share/xsessions/ubuntu.desktop
  tags: gdm

- name: Remove Gnome Desktop file ubuntu-communitheme-snap.desktop
  ansible.builtin.command:
    argv:
      - /bin/mv
      - /usr/share/xsessions/ubuntu-communitheme-snap.desktop
      - /usr/share/xsessions/ubuntu-communitheme-snap.desktop.dontuse
    creates: /usr/share/xsessions/ubuntu-communitheme-snap.desktop.dontuse
    removes: /usr/share/xsessions/ubuntu-communitheme-snap.desktop
  tags: gdm

- name: Copy GDM Config file
  ansible.builtin.copy:
    src: client-etc-gdm3-greeter.dconf-defaults
    dest: /etc/gdm3/greeter.dconf-defaults
    mode: 0644
    owner: root
    group: root
  notify: Restart gdm3
  tags: gdm

- name: Copy ubuntu.css to client
  ansible.builtin.copy:
    src: ubuntu-adfc.css
    dest: /usr/share/gnome-shell/theme/ubuntu-adfc.css
    mode: 0644
  notify: Restart gdm3
  tags: gdm

- name: Create Symbolic link to ubuntu-adfc.css
  ansible.builtin.file:
    src: /usr/share/gnome-shell/theme/ubuntu-adfc.css
    dest: /etc/alternatives/gdm3.css
    state: link
  notify: Restart gdm3
  tags: gdm

- name: Copy ADFC-Login background
  ansible.builtin.copy:
    src: ADFC-login-background.png
    dest: /usr/local/share/themes/adfc/ADFC-login-background.png
    mode: 0644
  notify: Restart gdm3
  tags: gdm

- name: Enable service gdm3
  ansible.builtin.systemd:
    state: started
    enabled: true
    name: gdm3
  tags: gdm
