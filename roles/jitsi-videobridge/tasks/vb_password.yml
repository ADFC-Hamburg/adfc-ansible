- name: stat password file
  stat:
    path: "{{ jitsi_meet_vb_password_file }}"
  register: vb_passwd_file_stat
  delegate_to: "{{ jitsi_meet_server }}"

- name: Generate Jvb Password if not set
  copy:
    content: "{{ lookup('password', '/dev/null length=16 chars=ascii_letters,digits') }}"
    dest: "{{ jitsi_meet_vb_password_file }}"
    mode: 0600
  when: not vb_passwd_file_stat.stat.exists
  delegate_to: "{{ jitsi_meet_server }}"

- name: Read Jvb Password
  slurp:
    src: "{{ jitsi_meet_vb_password_file }}"
  register: vb_password_file_slurp
  delegate_to: "{{ jitsi_meet_server }}"

- name: set Password
  set_fact:
     jitsi_meet_jvb_cfg_password: "{{ vb_password_file_slurp.content | b64decode }}"
